# КП Трекер

Веб‑сервис для формирования коммерческих предложений, отправки клиентам по ссылке, отслеживания просмотров и выгрузки итогового документа в PDF.

## Основные возможности
- создание коммерческих предложений с позициями, ценами и сроками действия;
- автоматическая генерация номера КП и защищённой ссылки для клиента;
- публичная страница просмотра с учётом статистики посещений;
- скачивание PDF‑версии предложения как для менеджера, так и для клиента;
- хранение данных в SQLite через Prisma ORM.

## Технологический стек
- [Next.js 15](https://nextjs.org/) (App Router, TypeScript, Tailwind CSS);
- [Prisma](https://www.prisma.io/) + SQLite для работы с данными;
- [PDFKit](https://pdfkit.org/) для генерации PDF.

## Требования
- Node.js 18+;
- npm (устанавливается вместе с Node.js).

## Быстрый старт
```bash
# Установка зависимостей
npm install

# Подготовка базы данных
npx prisma migrate dev --name init

# Запуск режима разработки
npm run dev
```

После запуска откройте [http://localhost:3000](http://localhost:3000), чтобы работать с приложением. Новое КП создаётся на странице `/proposals/new`.

### Переменные окружения
Все настройки находятся в файле `.env`. По умолчанию используется локальная SQLite-база:
```
DATABASE_URL="file:./prisma/dev.db"
```
При необходимости замените путь на собственный файл или используйте другой тип базы данных, обновив конфигурацию в `prisma/schema.prisma`.

### Управление схемой Prisma
```bash
# Проверка схемы
npx prisma validate

# Генерация Prisma Client (обычно выполняется автоматически)
npx prisma generate
```

## Сценарии npm
- `npm run dev` — запуск локального сервера разработки;
- `npm run build` — production-сборка Next.js;
- `npm run start` — запуск собранного приложения;
- `npm run lint` — проверка кода ESLint.

## Структура проекта
- `src/app` — маршруты Next.js (панель управления, публичная страница, API);
- `src/components` — клиентские React-компоненты (форма создания КП, кнопка копирования ссылки);
- `src/lib` — вспомогательные модули (Prisma Client, сервисы, форматирование);
- `prisma` — схема данных и миграции.

## Особенности разработки
- При первом запуске `npm run build` возможны предупреждения Next.js о нескольких lock-файлах. Убедитесь, что в рабочей директории проекта остается только один `package-lock.json`.
- PDF формируется динамически на сервере; для корректной работы убедитесь, что окружение разрешает запись во временную память процесса.

## Дальнейшие улучшения
- Добавить авторизацию и разграничение доступа по ролям;
- Настроить отправку уведомлений клиенту на email;
- Реализовать аналитику по источникам просмотров и статусы согласования.

Готово! Теперь вы можете формировать и отправлять коммерческие предложения прямо из приложения.
